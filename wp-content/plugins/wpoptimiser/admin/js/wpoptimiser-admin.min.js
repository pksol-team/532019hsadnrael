/*! wpoptimiser 30-05-2018 */
!function(a){"use strict";var b=function(c,d,e){a.ajax({type:"POST",url:ajaxurl,data:{_nonce:WPOptimiser_Admin.nonce,form:d,action:"process_bulk_image_optimization",step:c},dataType:"json",success:function(c){var f;"done"===c.step?(f=a("form.bulk-optimize"),f.find(".spinner").remove(),f.find(".bulk-progress-bar").remove(),a("div#bulk-optimiz-table > #overlay").remove(),window.location=c.url):"error"===c.step?(f=a("form.bulk-optimize"),f.find(".spinner").remove(),f.find(".bulk-progress-panel").remove(),a("div#bulk-optimiz-table > #overlay").remove(),f.prepend('<div class="error">'+c.message+"<div>")):(a(".bulk-progress-bar div").animate({width:c.percentage+"%"},50,function(){}),b(parseInt(c.step),d,e))}}).fail(function(a){window.console&&window.console.log&&console.log(a)})},c=function(b){a.ajax({type:"POST",url:ajaxurl,data:{_nonce:WPOptimiser_Admin.nonce,action:"process_db_optimization",dbaction:b},dataType:"json",success:function(b){var c,e=a("td."+b.dbaction);"done"===b.result?("db-optimize"===b.dbaction?(c=e.prev(),c.find(b.replace).replaceWith(b.html),d()):(c=e.prev(),c.find(b.replace).replaceWith(b.html)),e.html('<div class="button-action done">Completed<span class="dashicons dashicons-yes"></span></div>')):"error"===b.result&&(e.html('<div class="button-action err">Error Occurred - Please Try Again</div>'),a(".wrap").prepend('<div class="error">'+b.message+"<div>"))}}).fail(function(a){window.console&&window.console.log&&console.log(a)})},d=function(){a(".db-efficiency").easyPieChart({barColor:"#46d746",trackColor:"#f05959",scaleColor:!1,lineCap:"butt",lineWidth:8,animate:2e3,size:55})};a(document).ready(function(){a(".easypiechart").easyPieChart({barColor:"#9abc32",trackColor:"#EEEEEE",scaleColor:!1,lineCap:"round",lineWidth:10,animate:2e3,size:100}),d(),a('input[name^="wpoptimiser-bulkoptimizeimgs-options[compimg]"]').on("change",function(){a("div#bulk-optimiz-table").append('<div id="overlay"><div class="overlay-spinner"></div></div>'),a.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{_nonce:WPOptimiser_Admin.nonce,action:"update_bulk_compress_stats",sizes:a("table.bulk-optimize :input").serialize()},success:function(b){a(".uncomp-images span.infobox-data-number").html(b.available_unoptimized_sizes),a("span.uncomp-images").html(b.available_unoptimized_sizes),a(".est-costs span.infobox-data-number").html(b.estimated_costs),a("div#bulk-optimiz-table > #overlay").remove()},error:function(b,c,d){a("div#bulk-optimiz-table > #overlay").remove()}})}),a("form.bulk-optimize").on("submit",function(c){c.preventDefault();var d=a(this).serialize();a(".stats-info").remove(),a("div#bulk-optimiz-table").append('<div id="overlay"></div>'),a(this).prepend('<div class="bulk-progress-panel stats-info"><div>Processing Images...<span class="spinner is-active"></span></div><div class="bulk-progress-bar"><div></div></div></div>'),b(1,d,self)}),a("input.button-action").on("click",function(b){if(b.preventDefault(),confirm("It is highly recommended to have a backup of your database before performing the optimization. Press OK if you are happy to continue.")){var d=a(this).data("action");a(this).replaceWith('<div class="button-action">Performing Optimization...<span class="spinner is-active"></span></div>'),c(d)}}),a("#start-site-profile").click(function(){confirm("Are you sure you want to start the profiler? This may take several minutes and you must leave this window open to allow the profiler to complete successfully.")&&(a("p.submit").html('<div class="bulk-progress-panel"><div>Profiling Site Performance...<span class="spinner is-active"></span></div><div class="bulk-progress-bar"><div></div></div></div>'),a("tr.hidden").show(),e.start())})});var e={current_page:0,random:function(a){for(var b="",c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",d=0;d<a;d++)b+=c.charAt(Math.floor(Math.random()*c.length));return b},start:function(){if(a("#wpopti-cache-preventer").prop("checked"))for(i=0;i<WPOPSP_Pages.length;i++)WPOPSP_Pages[i].indexOf("?")>-1?WPOPSP_Pages[i]+="&WPOPTI_NOCACHE="+e.random(8):WPOPSP_Pages[i]+="?WPOPTI_NOCACHE="+e.random(8);var b={ip:WPOPSP_IP,action:"WPOPTI_start_profiling",nonce:WPOptimiser_Admin.nonce};a.post(ajaxurl,b,function(b){a("#wpopti-profiler-frame").attr("src",WPOPSP_Pages[0]),a("#wpopti-profiler-frame").attr("onload","window.WPOPTIS_Profiler.next_page();"),e.current_page=0,e.update_display()})},stop:function(){var b={action:"WPOPTI_stop_profiling",nonce:WPOptimiser_Admin.nonce};a.post(ajaxurl,b,function(a){alert("The profiling is complete, the page will be refreshed and the profile report will be displayed."),window.location.replace(WPOPSP_Location)})},update_display:function(){var b=e.current_page/(WPOPSP_Pages.length-1)*100;a(".bulk-progress-bar div").animate({width:b+"%"},50)},next_page:function(){if(e.current_page>=WPOPSP_Pages.length-1)return e.stop(),!0;a("#wpopti-profiler-frame").attr("src",WPOPSP_Pages[++e.current_page]),e.update_display()}};window.WPOPTIS_Profiler=e}(jQuery);